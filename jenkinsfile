pipeline{
  agent {
    docker{ image 'node:latest'}
  }
    stages{
    
      stage('Build application & test'){
        steps{
        sh 'npm install'
        }
        
          post{
            always {
              publishHTML([
              allowMissing: false, 
              alwaysLinkToLastBuild: false, 
              keepAll: false, 
              reportDir: 'coverage/lcov-report', 
              reportFiles: 'index.html', 
              reportName: 'Test coverage', 
              reportTitles: 'Test coverage'
              ])
            }
         }
      }
      
      stage('Deploy') {
        steps {
          sh 'asadmin --port 4848 deploy --force --name fortune-eleonorvb-linuss-${DEPLOY_ENV} --contextroot fortune-eleonorvb-linuss-${DEPLOY_ENV} dist\fortune-eleonorvb-linuss.war'
        }
      }          
  }
}
