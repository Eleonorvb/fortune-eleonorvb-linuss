pipeline{
agent any
 
    stages{
            stage('Build application, run tests and publish test results'){
                agent {
        docker{ image 'node:latest'}
                }
          environment {
        CI = 'true' 
    }
       stages {
        stage('Build') {
            steps {
                sh 'npm install'
            }
        }
                stage('Test') { 
            steps {
                sh './jenkins/scripts/test.sh' 
            }
        }
                post{
                    always {
                      
                   
                        publishHTML([
                            allowMissing: false, 
                            alwaysLinkToLastBuild: false, 
                            keepAll: false, 
                            reportDir: 'coverage/lcov-report', 
                            reportFiles: 'index.html', 
                            reportName: 'Test coverage', 
                            reportTitles: 'Test coverage'
                            ])
                    }
               

                }
              
            }
       
            
            

         
            
        }

}
}
